(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{334:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n(20),n(13),n(43);var r=n(38);function c(e){return"object"===Object(r.a)(e)&&null!==e&&e.constructor&&e.constructor===Object}function o(){for(var e=Object(arguments.length<=0?void 0:arguments[0]),i=1;i<arguments.length;i++){var t=i<0||arguments.length<=i?void 0:arguments[i];if(t)for(var n=Object.keys(Object(t)),r=0;r<n.length;r++){var l=n[r],desc=Object.getOwnPropertyDescriptor(t,l);desc&&desc.enumerable&&(c(e[l])&&c(t[l])?o(e[l],t[l]):!c(e[l])&&c(t[l])?(e[l]={},o(e[l],t[l])):e[l]=t[l])}}return e}},424:function(e,t,n){"use strict";n.r(t);n(56),n(25),n(20),n(13),n(43);var r=n(21),c=(n(177),n(178),n(134),n(90),n(127),n(91),n(9));n(87);function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=n(334);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function h(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="FileUpload",this.options={type:"any",max:0,accept:"",request:{url:"http://lab.myweb.com/api/upload"},image:{validate:!0,precision:!0,width:0,height:0,maxWidth:0,maxHeight:0},validate:["type","size","wh"],success:null,progress:null,fail:null,complete:null},this.fileConfig={any:{desc:"文件"},image:{desc:"图片",accept:"jpeg|jpg|png|gif"},video:{desc:"视频",accept:"mp4|avi|mkv|mov|3gp|wmv|mpg|vob|flv"},audio:{desc:"音频",accept:"mp3|wav"},file:{desc:"文件",accept:"xlsx|xltx|xlsm|xls|csv|pdf|docx|dotx|dotm|docm|doc|sheet"}}}var t,n,r,f,d,v;return t=e,(n=[{key:"_validate",value:(v=Object(c.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.validate){e.next=2;break}return e.abrupt("return",!0);case 2:if("any"===this.options.type||!this.options.validate.includes("type")){e.next=5;break}if(this._validateType(t)){e.next=5;break}return e.abrupt("return");case 5:if(!this.options.validate.includes("size")){e.next=8;break}if(this._validateSize(t)){e.next=8;break}return e.abrupt("return");case 8:if("image"!==this.type||!this.image.image||!this.options.validate.includes("wh")){e.next=13;break}return e.next=11,this._validateWidthAndHeight(t);case 11:if(e.sent){e.next=13;break}return e.abrupt("return");case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"_validateType",value:function(e){var t=this.fileConfig[this.options.type],n=t.accept,desc=t.desc;return!!new RegExp(".(".concat(this.options.accept||n,")$")).test(e.name.toLowerCase())||(this._callback("fail",{type:"validate",message:"只允许上传".concat(this.options.accept||n,"格式的").concat(desc)}),!1)}},{key:"_validateSize",value:function(e){var desc=this.fileConfig[this.options.type].desc;return!(0!==this.options.max&&e.size/1024/1024>this.options.max&&(this._callback("fail",{type:"validate",message:"上传".concat(desc,"大小不能超过").concat(this.options.max,"MB")}),1))}},{key:"_validateWidthAndHeight",value:(d=Object(c.a)(regeneratorRuntime.mark((function e(t){var n,r,c,o,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.options.image,r=n.precision,c=n.width,o=n.height,l=n.maxWidth,f=n.maxHeight,e.next=3,this._getImageBaseInfo(t,"file");case 3:if(h=e.sent,!r){e.next=11;break}if(c===h.width&&o===h.height){e.next=8;break}return this._callback("fail",{type:"validate",message:"请确保上传图片尺寸为".concat(c,"*").concat(o)}),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 11:if(!(c&&h.width<c||l&&h.maxWidth>l||o&&h.height<o||f&&h.maxHeight>f)){e.next=14;break}return this._callback("fail",{type:"validate",message:"上传图片尺寸".concat(c?"【最小宽度为：".concat(c,"】"):"").concat(o?"【最小高度为：".concat(o,"】"):"").concat(l?"【最大宽度为：".concat(l,"】"):"").concat(f?"【最大高度为：".concat(f,"】"):"")}),e.abrupt("return",!1);case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_createFormData",value:function(e){var t=new FormData;return t.append("file[0]",e),t}},{key:"_getImageBaseInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"url";return new Promise((function(n){if("url"===t){var img=new Image;img.src=e.src,img.onload=function(){n(h({},e,{width:img.width,height:img.height}))}}else{var r=new FileReader;r.readAsDataURL(e),r.onload=function(t){var image=new Image;image.src=t.target.result,image.onload=function(){n({file:e,width:this.width,height:this.height})}}}}))}},{key:"_callback",value:function(e,t){console.log("callback",e,t),this.options[e]&&this.options[e](t),"progress"!==e&&this.options.complete&&this.options.complete()}},{key:"_request",value:function(e){var t=this;return $request({url:this.options.request.url,method:"post",data:e,onUploadProgress:function(e){t._callback("progress",e)}})}},{key:"getType",value:function(e){return Object.prototype.toString.call(e)}},{key:"_start",value:(f=Object(c.a)(regeneratorRuntime.mark((function e(t,n){var r,c,i,o,f=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object.keys(n).length&&(this.options=Object(l.a)(this.options,n)),r="[object Array]"===this.getType(t),c=!0,!r){e.next=16;break}i=0;case 5:if(!(i<t.length)){e.next=14;break}return e.next=8,this._validate(t[i]);case 8:if(e.sent){e.next=11;break}return c=!1,e.abrupt("break",14);case 11:i++,e.next=5;break;case 14:e.next=19;break;case 16:return e.next=18,this._validate(t);case 18:c=e.sent;case 19:c&&(o=this._createFormData(t),this._request(o).then((function(e){200===e.code?f.options.success&&"image"===f.type?f._getImageBaseInfo(e.data).then((function(e){f._callback("success",e)})):f._callback("success",result):f._callback("fail",e)})).catch((function(e){f._callback("fail",e)})));case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"upload",value:function(e,t){this._start(e,t).then((function(e){console.log("_start running",e)}))}}])&&o(t.prototype,n),r&&o(t,r),e}(),v=n(54);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var y=function(e,t){var n=new d,c=null;n.upload(e,function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},t,{progress:function(e){var time;time=e.loaded/e.total*100|0,c?c.setText(100===time?"处理中……":"".concat(time,"%")):c=v.Loading.service({background:"rgba(0,0,0,0.4)",spinner:"el-icon-loading",text:"".concat(time,"%")}),console.log("progress",e)},fail:function(e){console.log("fail",e)},complete:function(){c&&c.close()}}))},k={name:"UploadIndex",data:function(){return{fileList:[]}},methods:{handleUpload:function(data){console.log(data),y(data.file,{success:function(e){console.log("成功",e)}})}}},O=n(5),component=Object(O.a)(k,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{display:"inline-block"},attrs:{accept:"image/*",name:"image",action:"",limit:1,"show-file-list":!1,"http-request":this.handleUpload,"file-list":this.fileList,multiple:""}},[t("el-button",{attrs:{type:"primary",plain:"",size:"mini",icon:"el-icon-plus"}},[this._v("上传图片")])],1)],1)}),[],!1,null,"39599ff8",null);t.default=component.exports}}]);