(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{342:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n(37),n(12),n(47);var r=n(41);function o(e){return"object"===Object(r.a)(e)&&null!==e&&e.constructor&&e.constructor===Object}function c(){for(var e=Object(arguments.length<=0?void 0:arguments[0]),i=1;i<arguments.length;i++){var t=i<0||arguments.length<=i?void 0:arguments[i];if(t)for(var n=Object.keys(Object(t)),r=0;r<n.length;r++){var l=n[r],desc=Object.getOwnPropertyDescriptor(t,l);desc&&desc.enumerable&&(o(e[l])&&o(t[l])?c(e[l],t[l]):!o(e[l])&&o(t[l])?(e[l]={},c(e[l],t[l])):e[l]=t[l])}}return e}},428:function(e,t,n){"use strict";n.r(t);n(48),n(61),n(38),n(25),n(37),n(12),n(47);var r=n(21),o=(n(59),n(60),n(137),n(90),n(130),n(92),n(10));n(46);function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=n(342);function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="FileUpload",this.options={type:"any",max:0,accept:"",request:{url:"http://lab.myweb.com/api/upload"},image:{validate:!0,precision:!0,width:0,height:0,maxWidth:0,maxHeight:0,result:!1},validate:["type","size","wh"],success:null,progress:null,fail:null,complete:null},this.fileConfig={any:{desc:"文件"},image:{desc:"图片",accept:"jpeg|jpg|png|gif"},video:{desc:"视频",accept:"mp4|avi|mkv|mov|3gp|wmv|mpg|vob|flv"},audio:{desc:"音频",accept:"mp3|wav"},file:{desc:"文件",accept:"xlsx|xltx|xlsm|xls|csv|pdf|docx|dotx|dotm|docm|doc|sheet"}}}var t,n,r,h,d,m;return t=e,(n=[{key:"_validate",value:(m=Object(o.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.validate){e.next=2;break}return e.abrupt("return",!0);case 2:if("any"===this.options.type||!this.options.validate.includes("type")){e.next=5;break}if(this._validateType(t)){e.next=5;break}return e.abrupt("return");case 5:if(!this.options.validate.includes("size")){e.next=8;break}if(this._validateSize(t)){e.next=8;break}return e.abrupt("return");case 8:if("image"!==this.type||!this.image.image||!this.options.validate.includes("wh")){e.next=13;break}return e.next=11,this._validateWidthAndHeight(t);case 11:if(e.sent){e.next=13;break}return e.abrupt("return");case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"_validateType",value:function(e){var t=this.fileConfig[this.options.type],n=t.accept,desc=t.desc;return!!new RegExp(".(".concat(this.options.accept||n,")$")).test(e.name.toLowerCase())||(this._callback("fail",{type:"validate",message:"只允许上传".concat(this.options.accept||n,"格式的").concat(desc)}),!1)}},{key:"_validateSize",value:function(e){var desc=this.fileConfig[this.options.type].desc;return!(0!==this.options.max&&e.size/1024/1024>this.options.max&&(this._callback("fail",{type:"validate",message:"上传".concat(desc,"大小不能超过").concat(this.options.max,"MB")}),1))}},{key:"_validateWidthAndHeight",value:(d=Object(o.a)(regeneratorRuntime.mark((function e(t){var n,r,o,c,l,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.options.image,r=n.precision,o=n.width,c=n.height,l=n.maxWidth,h=n.maxHeight,e.next=3,this._getImageBaseInfo(t,"file");case 3:if(f=e.sent,!r){e.next=11;break}if(o===f.width&&c===f.height){e.next=8;break}return this._callback("fail",{type:"validate",message:"请确保上传图片尺寸为".concat(o,"*").concat(c)}),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 11:if(!(o&&f.width<o||l&&f.maxWidth>l||c&&f.height<c||h&&f.maxHeight>h)){e.next=14;break}return this._callback("fail",{type:"validate",message:"上传图片尺寸".concat(o?"【最小宽度为：".concat(o,"】"):"").concat(c?"【最小高度为：".concat(c,"】"):"").concat(l?"【最大宽度为：".concat(l,"】"):"").concat(h?"【最大高度为：".concat(h,"】"):"")}),e.abrupt("return",!1);case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_createFormData",value:function(e){var t="[object Array]"===this.getType(e),n=new FormData;return t?e.forEach((function(e,t){n.append("file[".concat(t,"]"),e)})):n.append("file[0]",e),n}},{key:"_getImageBaseInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"url";return new Promise((function(n){if("url"===t){var img=new Image;img.src=e.src,img.onload=function(){n(f(f({},e),{},{width:img.width,height:img.height}))}}else{var r=new FileReader;r.readAsDataURL(e),r.onload=function(t){var image=new Image;image.src=t.target.result,image.onload=function(){n({file:e,width:this.width,height:this.height})}}}}))}},{key:"_callback",value:function(e,t){console.log("callback",e,t),this.options[e]&&this.options[e](t),"progress"!==e&&this.options.complete&&this.options.complete()}},{key:"_request",value:function(e){var t=this;return $request({url:this.options.request.url,method:"post",data:e,onUploadProgress:function(e){t._callback("progress",e)}})}},{key:"getType",value:function(e){return Object.prototype.toString.call(e)}},{key:"_start",value:(h=Object(o.a)(regeneratorRuntime.mark((function e(t,n){var r,o,i,c,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object.keys(n).length&&(this.options=Object(l.a)(this.options,n)),r="[object Array]"===this.getType(t),o=!0,!r){e.next=16;break}i=0;case 5:if(!(i<t.length)){e.next=14;break}return e.next=8,this._validate(t[i]);case 8:if(e.sent){e.next=11;break}return o=!1,e.abrupt("break",14);case 11:i++,e.next=5;break;case 14:e.next=19;break;case 16:return e.next=18,this._validate(t);case 18:o=e.sent;case 19:o&&(c=this._createFormData(t),this._request(c).then((function(e){200===e.code?h.options.success&&"image"===h.type?h._getImageBaseInfo(e.data).then((function(e){h._callback("success",e)})):h._callback("success",e):h._callback("fail",e)})).catch((function(e){h._callback("fail",e)})));case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"upload",value:function(e,t){this._start(e,t).then((function(e){console.log("_start running",e)}))}}])&&c(t.prototype,n),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),m=n(57);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function y(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var w=function(e,t){var n=new d,r=null;n.upload(e,y(y({},t),{},{progress:function(e){var time;time=e.loaded/e.total*100|0,r?r.setText(100===time?"处理中……":"".concat(time,"%")):r=m.Loading.service({background:"rgba(0,0,0,0.4)",spinner:"el-icon-loading",text:"".concat(time,"%")}),console.log("progress",e)},fail:function(e){console.log("fail",e)},complete:function(){r&&r.close(),t.complete&&t.complete()}}))},O={name:"UploadIndex",data:function(){return{fileList:[],timer:null}},methods:{handleChange:function(e,t){var n=this;console.log(t),this.fileList=t,this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){n.handleUpload(),clearTimeout(n.timer)}),100)},handleUpload:function(data){console.log(data,"handleUpload");var e=this;w(this.fileList.map((function(e){return e.raw})),{success:function(e){console.log("成功",e)},complete:function(){e.$refs.upload.clearFiles()}})}}},k=n(6),component=Object(k.a)(O,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{display:"inline-block"},attrs:{accept:"image/*",name:"image",action:"",limit:100,"show-file-list":!1,"on-change":this.handleChange,"file-list":this.fileList,multiple:"","auto-upload":!1}},[t("el-button",{attrs:{type:"primary",plain:"",size:"mini",icon:"el-icon-plus"}},[this._v("上传图片")])],1)],1)}),[],!1,null,"38ab2b61",null);t.default=component.exports}}]);